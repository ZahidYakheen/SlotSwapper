<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlotSwapper - Peer-to-Peer Scheduling</title>
    <style>
/* ==================== GLOBAL STYLES ==================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #333;
}

/* ==================== CONTAINER ==================== */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* ==================== NAVBAR ==================== */
.navbar {
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 30px;
    border-radius: 8px;
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.navbar-brand {
    font-size: 24px;
    font-weight: bold;
    color: #667eea;
}

.navbar-menu {
    display: flex;
    gap: 25px;
    list-style: none;
}

.navbar-menu a {
    text-decoration: none;
    color: #666;
    font-weight: 500;
    padding: 8px 12px;
    border-radius: 4px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.navbar-menu a:hover,
.navbar-menu a.active {
    background: #667eea;
    color: white;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-name {
    font-weight: 600;
    color: #333;
}

.logout-btn {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
}

.logout-btn:hover {
    background: #c0392b;
}

/* ==================== AUTH PAGES ==================== */
.auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.auth-box {
    background: white;
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    width: 100%;
    max-width: 400px;
}

.auth-title {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 30px;
    text-align: center;
    color: #333;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-group input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    font-size: 16px;
    transition: border-color 0.3s ease;
}

.form-group input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.btn-primary {
    width: 100%;
    padding: 12px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
    margin-top: 10px;
}

.btn-primary:hover {
    background: #5568d3;
}

.btn-secondary {
    width: 100%;
    padding: 12px;
    background: #f0f0f0;
    color: #333;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
}

.btn-secondary:hover {
    background: #e0e0e0;
}

.auth-toggle {
    text-align: center;
    margin-top: 20px;
    color: #666;
}

.auth-toggle a {
    color: #667eea;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
}

.auth-toggle a:hover {
    text-decoration: underline;
}

.error-message {
    background: #fee;
    color: #c33;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 15px;
    border-left: 4px solid #c33;
}

.success-message {
    background: #efe;
    color: #3c3;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 15px;
    border-left: 4px solid #3c3;
}

/* ==================== DASHBOARD ==================== */
.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.dashboard-header h1 {
    font-size: 28px;
    color: #333;
}

.btn-create {
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
}

.btn-create:hover {
    background: #5568d3;
}

/* ==================== EVENT CARDS ==================== */
.events-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.event-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 5px solid #667eea;
    transition: all 0.3s ease;
}

.event-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}

.event-card.busy {
    border-left-color: #3498db;
}

.event-card.swappable {
    border-left-color: #2ecc71;
}

.event-card.swap-pending {
    border-left-color: #f39c12;
    opacity: 0.7;
}

.event-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
}

.event-time {
    color: #666;
    font-size: 14px;
    margin-bottom: 8px;
}

.event-status {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 15px;
}

.status-busy {
    background: #e3f2fd;
    color: #1976d2;
}

.status-swappable {
    background: #e8f5e9;
    color: #388e3c;
}

.status-pending {
    background: #fff3e0;
    color: #f57c00;
}

.event-actions {
    display: flex;
    gap: 10px;
}

.btn-sm {
    flex: 1;
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-success {
    background: #2ecc71;
    color: white;
}

.btn-success:hover {
    background: #27ae60;
}

.btn-danger {
    background: #e74c3c;
    color: white;
}

.btn-danger:hover {
    background: #c0392b;
}

.btn-warning {
    background: #f39c12;
    color: white;
}

.btn-warning:hover {
    background: #e67e22;
}

.btn-info {
    background: #3498db;
    color: white;
}

.btn-info:hover {
    background: #2980b9;
}

.btn-sm:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* ==================== MARKETPLACE ==================== */
.marketplace-header {
    background: white;
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 30px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.marketplace-header h2 {
    font-size: 24px;
    color: #333;
}

.empty-state {
    background: white;
    padding: 40px;
    border-radius: 8px;
    text-align: center;
    color: #999;
}

.empty-state p {
    font-size: 18px;
}

/* ==================== MODAL ==================== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.modal-title {
    font-size: 22px;
    font-weight: bold;
    color: #333;
}

.modal-close {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #999;
}

.modal-close:hover {
    color: #333;
}

.modal-body {
    margin-bottom: 20px;
}

.modal-footer {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.form-section {
    margin-bottom: 20px;
}

.form-section h3 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 15px;
    color: #333;
}

/* ==================== SWAP REQUESTS ==================== */
.swap-section {
    margin-bottom: 30px;
}

.swap-section-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 15px;
    color: #333;
    padding-bottom: 10px;
    border-bottom: 2px solid #667eea;
}

.swap-request-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 15px;
    border-left: 5px solid #667eea;
}

.swap-details {
    margin-bottom: 15px;
}

.swap-details p {
    margin-bottom: 8px;
    color: #666;
    font-size: 14px;
}

.slot-info {
    background: #f5f5f5;
    padding: 10px 15px;
    border-radius: 6px;
    margin: 8px 0;
    font-weight: 500;
    color: #333;
}

.swap-actions {
    display: flex;
    gap: 10px;
}

.swap-status {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    color: #f39c12;
    background: #fff3e0;
}

.swap-status.accepted {
    color: #2ecc71;
    background: #e8f5e9;
}

.swap-status.rejected {
    color: #e74c3c;
    background: #fadbd8;
}

/* ==================== SLOT SELECTOR ==================== */
.slot-selector {
    margin-top: 20px;
}

.slot-selector-title {
    font-weight: 600;
    margin-bottom: 12px;
    color: #333;
}

.slot-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.slot-option {
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.slot-option input[type="radio"] {
    cursor: pointer;
}

.slot-option:hover {
    border-color: #667eea;
    background: #f9f9ff;
}

.slot-option.selected {
    border-color: #667eea;
    background: #f0f4ff;
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .navbar {
        flex-direction: column;
        gap: 15px;
    }

    .navbar-menu {
        flex-direction: column;
        gap: 10px;
        width: 100%;
    }

    .events-grid {
        grid-template-columns: 1fr;
    }

    .modal-content {
        width: 95%;
    }

    .dashboard-header {
        flex-direction: column;
        gap: 15px;
    }

    .btn-create {
        width: 100%;
    }
}

/* ==================== UTILITY ==================== */
.hidden {
    display: none !important;
}

.text-center {
    text-align: center;
}

.mt-20 {
    margin-top: 20px;
}

.mb-20 {
    margin-bottom: 20px;
}
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
// ==================== STATE MANAGEMENT ====================
let appState = {
    currentUser: null,
    users: [
        { id: 1, name: 'Alice Smith', email: 'alice@test.com', password: 'password123' },
        { id: 2, name: 'Bob Jones', email: 'bob@test.com', password: 'password123' },
        { id: 3, name: 'Carol White', email: 'carol@test.com', password: 'password123' }
    ],
    events: [
        { id: 1, userId: 1, title: 'Team Meeting', startTime: '2025-11-11T10:00', endTime: '2025-11-11T11:00', status: 'SWAPPABLE' },
        { id: 2, userId: 1, title: 'Client Call', startTime: '2025-11-10T14:00', endTime: '2025-11-10T15:00', status: 'BUSY' },
        { id: 3, userId: 2, title: 'Focus Block', startTime: '2025-11-12T14:00', endTime: '2025-11-12T15:00', status: 'SWAPPABLE' },
        { id: 4, userId: 2, title: 'Code Review', startTime: '2025-11-13T09:00', endTime: '2025-11-13T10:00', status: 'BUSY' },
        { id: 5, userId: 3, title: 'Design Session', startTime: '2025-11-14T11:00', endTime: '2025-11-14T12:00', status: 'SWAPPABLE' },
        { id: 6, userId: 3, title: 'Standup', startTime: '2025-11-10T09:00', endTime: '2025-11-10T09:30', status: 'BUSY' }
    ],
    swapRequests: [],
    nextEventId: 7,
    nextSwapRequestId: 1,
    currentPage: 'login'
};

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', () => {
    const app = document.getElementById('app');
    renderAuthPage(app);
});

// ==================== RENDERING FUNCTIONS ====================
function renderApp(page) {
    const app = document.getElementById('app');
    app.innerHTML = '';

    if (!appState.currentUser) {
        renderAuthPage(app);
        return;
    }

    switch(page) {
        case 'dashboard':
            renderDashboard(app);
            break;
        case 'marketplace':
            renderMarketplace(app);
            break;
        case 'swaps':
            renderSwapRequests(app);
            break;
        default:
            renderDashboard(app);
    }

    appState.currentPage = page;
}

function renderAuthPage(app) {
    let isSignUp = false;

    const updateAuthForm = () => {
        authContainer.innerHTML = isSignUp ? getSignUpForm() : getLoginForm();
        attachAuthListeners();
    };

    const getLoginForm = () => `
        <div class="auth-box">
            <div class="auth-title">Login to SlotSwapper</div>
            <div id="auth-message"></div>
            <form id="login-form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn-primary">Log In</button>
            </form>
            <div class="auth-toggle">
                Don't have an account? <a onclick="toggleAuthMode()">Sign Up</a>
            </div>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                <p style="font-size: 13px; color: #999; margin-bottom: 8px;"><strong>Demo Accounts:</strong></p>
                <p style="font-size: 12px; color: #999;">alice@test.com</p>
                <p style="font-size: 12px; color: #999;">bob@test.com</p>
                <p style="font-size: 12px; color: #999;">carol@test.com</p>
                <p style="font-size: 12px; color: #999;"><strong>Password:</strong> password123</p>
            </div>
        </div>
    `;

    const getSignUpForm = () => `
        <div class="auth-box">
            <div class="auth-title">Create Account</div>
            <div id="auth-message"></div>
            <form id="signup-form">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="signup-name" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signup-email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signup-password" required>
                </div>
                <button type="submit" class="btn-primary">Create Account</button>
            </form>
            <div class="auth-toggle">
                Already have an account? <a onclick="toggleAuthMode()">Log In</a>
            </div>
        </div>
    `;

    const authContainer = document.createElement('div');
    authContainer.className = 'auth-container';
    app.appendChild(authContainer);

    updateAuthForm();

    window.toggleAuthMode = () => {
        isSignUp = !isSignUp;
        updateAuthForm();
    };

    function attachAuthListeners() {
        if (isSignUp) {
            document.getElementById('signup-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;

                if (appState.users.find(u => u.email === email)) {
                    showMessage('auth-message', 'Email already exists', 'error');
                    return;
                }

                const newUser = {
                    id: Math.max(...appState.users.map(u => u.id)) + 1,
                    name,
                    email,
                    password
                };
                appState.users.push(newUser);
                appState.currentUser = newUser;
                showMessage('auth-message', 'Account created! Redirecting...', 'success');
                setTimeout(() => renderApp('dashboard'), 1000);
            });
        } else {
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;

                const user = appState.users.find(u => u.email === email && u.password === password);
                if (!user) {
                    showMessage('auth-message', 'Invalid email or password', 'error');
                    return;
                }

                appState.currentUser = user;
                renderApp('dashboard');
            });
        }
    }
}

function renderDashboard(app) {
    const userEvents = appState.events.filter(e => e.userId === appState.currentUser.id);

    const html = `
        ${getNavbar('dashboard')}
        <div class="container">
            <div class="dashboard-header">
                <h1>My Calendar</h1>
                <button class="btn-create" onclick="openCreateEventModal()">+ Create Event</button>
            </div>

            ${userEvents.length === 0 ? '<div class="empty-state"><p>No events yet. Create one to get started!</p></div>' : `
                <div class="events-grid">
                    ${userEvents.map(event => getEventCard(event)).join('')}
                </div>
            `}
        </div>
        ${getCreateEventModal()}
    `;

    app.innerHTML = html;
}

function renderMarketplace(app) {
    const otherUsersEvents = appState.events.filter(
        e => e.userId !== appState.currentUser.id && e.status === 'SWAPPABLE'
    );

    const html = `
        ${getNavbar('marketplace')}
        <div class="container">
            <div class="marketplace-header">
                <h2>Available Slots for Swap</h2>
            </div>

            ${otherUsersEvents.length === 0 ? '<div class="empty-state"><p>No available slots at the moment</p></div>' : `
                <div class="events-grid">
                    ${otherUsersEvents.map(event => getMarketplaceCard(event)).join('')}
                </div>
            `}
        </div>
        ${getSwapRequestModal()}
    `;

    app.innerHTML = html;
}

function renderSwapRequests(app) {
    const incomingRequests = appState.swapRequests.filter(r => r.targetUserId === appState.currentUser.id);
    const outgoingRequests = appState.swapRequests.filter(r => r.requesterId === appState.currentUser.id);

    const html = `
        ${getNavbar('swaps')}
        <div class="container">
            <div class="swap-section">
                <div class="swap-section-title">üì• Incoming Requests</div>
                ${incomingRequests.length === 0 ? '<div class="empty-state"><p>No incoming swap requests</p></div>' : `
                    ${incomingRequests.map(request => getIncomingSwapCard(request)).join('')}
                `}
            </div>

            <div class="swap-section">
                <div class="swap-section-title">üì§ Outgoing Requests</div>
                ${outgoingRequests.length === 0 ? '<div class="empty-state"><p>No outgoing swap requests</p></div>' : `
                    ${outgoingRequests.map(request => getOutgoingSwapCard(request)).join('')}
                `}
            </div>
        </div>
    `;

    app.innerHTML = html;
}

// ==================== COMPONENT HELPERS ====================
function getNavbar(currentPage) {
    return `
        <nav class="navbar">
            <div class="navbar-brand">SlotSwapper</div>
            <ul class="navbar-menu">
                <li><a class="${currentPage === 'dashboard' ? 'active' : ''}" onclick="renderApp('dashboard')">üìÖ Dashboard</a></li>
                <li><a class="${currentPage === 'marketplace' ? 'active' : ''}" onclick="renderApp('marketplace')">üîç Marketplace</a></li>
                <li><a class="${currentPage === 'swaps' ? 'active' : ''}" onclick="renderApp('swaps')">‚ö° Swap Requests</a></li>
            </ul>
            <div class="user-info">
                <span class="user-name">üë§ ${appState.currentUser.name}</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </nav>
    `;
}

function getEventCard(event) {
    const user = appState.users.find(u => u.id === event.userId);
    const startTime = new Date(event.startTime).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    const endTime = new Date(event.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

    const statusClass = event.status.toLowerCase().replace('_', '-');
    const statusDisplay = event.status === 'SWAP_PENDING' ? 'Pending Swap' : event.status;

    return `
        <div class="event-card ${statusClass}">
            <div class="event-title">${event.title}</div>
            <div class="event-time">${startTime} - ${endTime}</div>
            <div class="event-status status-${statusClass}">${statusDisplay}</div>
            <div class="event-actions">
                ${event.status === 'BUSY' ? `<button class="btn-sm btn-success" onclick="toggleSwappable(${event.id}, true)">Make Swappable</button>` : ''}
                ${event.status === 'SWAPPABLE' ? `<button class="btn-sm btn-warning" onclick="toggleSwappable(${event.id}, false)">Make Busy</button>` : ''}
                ${event.status !== 'SWAP_PENDING' ? `<button class="btn-sm btn-danger" onclick="deleteEvent(${event.id})">Delete</button>` : ''}
            </div>
        </div>
    `;
}

function getMarketplaceCard(event) {
    const user = appState.users.find(u => u.id === event.userId);
    const startTime = new Date(event.startTime).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    const endTime = new Date(event.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

    return `
        <div class="event-card swappable">
            <div class="event-title">${event.title}</div>
            <div class="event-time">${startTime} - ${endTime}</div>
            <div class="event-status status-swappable">Owner: ${user.name}</div>
            <div class="event-actions">
                <button class="btn-sm btn-info" onclick="openSwapRequestModal(${event.id})">Request Swap</button>
            </div>
        </div>
    `;
}

function getIncomingSwapCard(request) {
    const requester = appState.users.find(u => u.id === request.requesterId);
    const requesterSlot = appState.events.find(e => e.id === request.requesterSlotId);
    const targetSlot = appState.events.find(e => e.id === request.targetSlotId);

    const requesterStart = new Date(requesterSlot.startTime).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    const requesterEnd = new Date(requesterSlot.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    const targetStart = new Date(targetSlot.startTime).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    const targetEnd = new Date(targetSlot.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

    return `
        <div class="swap-request-card">
            <div class="swap-details">
                <p><strong>${requester.name}</strong> wants to swap:</p>
                <div class="slot-info">üìå ${requesterSlot.title} ‚Ä¢ ${requesterStart} - ${requesterEnd}</div>
                <p>For your slot:</p>
                <div class="slot-info">üìå ${targetSlot.title} ‚Ä¢ ${targetStart} - ${targetEnd}</div>
            </div>
            ${request.status === 'PENDING' ? `
                <div class="swap-actions">
                    <button class="btn-sm btn-success" onclick="acceptSwap(${request.id})">Accept</button>
                    <button class="btn-sm btn-danger" onclick="rejectSwap(${request.id})">Reject</button>
                </div>
            ` : `
                <div class="swap-status ${request.status.toLowerCase()}">${request.status}</div>
            `}
        </div>
    `;
}

function getOutgoingSwapCard(request) {
    const target = appState.users.find(u => u.id === request.targetUserId);
    const requesterSlot = appState.events.find(e => e.id === request.requesterSlotId);
    const targetSlot = appState.events.find(e => e.id === request.targetSlotId);

    const requesterStart = new Date(requesterSlot.startTime).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    const requesterEnd = new Date(requesterSlot.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    const targetStart = new Date(targetSlot.startTime).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    const targetEnd = new Date(targetSlot.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

    return `
        <div class="swap-request-card">
            <div class="swap-details">
                <p>You offered to swap with <strong>${target.name}</strong>:</p>
                <div class="slot-info">üìå ${requesterSlot.title} ‚Ä¢ ${requesterStart} - ${requesterEnd}</div>
                <p>For their slot:</p>
                <div class="slot-info">üìå ${targetSlot.title} ‚Ä¢ ${targetStart} - ${targetEnd}</div>
            </div>
            <div class="swap-status ${request.status.toLowerCase()}">${request.status}</div>
        </div>
    `;
}

function getCreateEventModal() {
    return `
        <div id="createEventModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Create New Event</h2>
                    <button class="modal-close" onclick="closeModal('createEventModal')">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="create-event-form">
                        <div class="form-group">
                            <label>Event Title</label>
                            <input type="text" id="event-title" required>
                        </div>
                        <div class="form-group">
                            <label>Start Date & Time</label>
                            <input type="datetime-local" id="event-start" required>
                        </div>
                        <div class="form-group">
                            <label>End Date & Time</label>
                            <input type="datetime-local" id="event-end" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeModal('createEventModal')">Cancel</button>
                    <button class="btn-primary" onclick="createEvent()">Create Event</button>
                </div>
            </div>
        </div>
    `;
}

function getSwapRequestModal() {
    const userSwappableSlots = appState.events.filter(e => e.userId === appState.currentUser.id && e.status === 'SWAPPABLE');
    const selectedEventId = window.selectedEventIdForSwap;

    return `
        <div id="swapRequestModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Request Swap</h2>
                    <button class="modal-close" onclick="closeModal('swapRequestModal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-section">
                        <h3>Select Your Slot to Offer</h3>
                        ${userSwappableSlots.length === 0 ? '<p style="color: #999;">You have no swappable slots</p>' : `
                            <div class="slot-options">
                                ${userSwappableSlots.map(slot => `
                                    <label class="slot-option">
                                        <input type="radio" name="offerSlot" value="${slot.id}" />
                                        <div>
                                            <strong>${slot.title}</strong><br>
                                            <small>${new Date(slot.startTime).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })} - ${new Date(slot.endTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</small>
                                        </div>
                                    </label>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeModal('swapRequestModal')">Cancel</button>
                    <button class="btn-primary" onclick="confirmSwapRequest()" ${userSwappableSlots.length === 0 ? 'disabled' : ''}>Confirm Swap Request</button>
                </div>
            </div>
        </div>
    `;
}

// ==================== MODAL FUNCTIONS ====================
function openCreateEventModal() {
    document.getElementById('createEventModal').classList.add('active');
}

function openSwapRequestModal(eventId) {
    window.selectedEventIdForSwap = eventId;
    const modalHtml = getSwapRequestModal();
    document.getElementById('app').insertAdjacentHTML('beforeend', modalHtml);
    document.getElementById('swapRequestModal').classList.add('active');
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        if (modalId === 'swapRequestModal') {
            modal.remove();
        }
    }
}

// ==================== EVENT FUNCTIONS ====================
function createEvent() {
    const title = document.getElementById('event-title').value;
    const startTime = document.getElementById('event-start').value;
    const endTime = document.getElementById('event-end').value;

    if (!title || !startTime || !endTime) {
        alert('Please fill in all fields');
        return;
    }

    const newEvent = {
        id: appState.nextEventId++,
        userId: appState.currentUser.id,
        title,
        startTime,
        endTime,
        status: 'BUSY'
    };

    appState.events.push(newEvent);
    closeModal('createEventModal');
    renderApp('dashboard');
    showMessage(null, 'Event created successfully!', 'success');
}

function deleteEvent(eventId) {
    if (confirm('Are you sure you want to delete this event?')) {
        appState.events = appState.events.filter(e => e.id !== eventId);
        renderApp('dashboard');
    }
}

function toggleSwappable(eventId, makeSwappable) {
    const event = appState.events.find(e => e.id === eventId);
    if (event) {
        event.status = makeSwappable ? 'SWAPPABLE' : 'BUSY';
        renderApp('dashboard');
    }
}

// ==================== SWAP FUNCTIONS ====================
function confirmSwapRequest() {
    const selectedSlot = document.querySelector('input[name="offerSlot"]:checked');
    if (!selectedSlot) {
        alert('Please select a slot to offer');
        return;
    }

    const requesterSlotId = parseInt(selectedSlot.value);
    const targetSlotId = window.selectedEventIdForSwap;

    const requesterSlot = appState.events.find(e => e.id === requesterSlotId);
    const targetSlot = appState.events.find(e => e.id === targetSlotId);

    if (!requesterSlot || !targetSlot) {
        alert('Invalid slot selection');
        return;
    }

    const newRequest = {
        id: appState.nextSwapRequestId++,
        requesterId: appState.currentUser.id,
        requesterSlotId,
        targetUserId: targetSlot.userId,
        targetSlotId,
        status: 'PENDING'
    };

    appState.swapRequests.push(newRequest);
    requesterSlot.status = 'SWAP_PENDING';
    targetSlot.status = 'SWAP_PENDING';

    closeModal('swapRequestModal');
    renderApp('marketplace');
    showMessage(null, 'Swap request sent!', 'success');
}

function acceptSwap(requestId) {
    const request = appState.swapRequests.find(r => r.id === requestId);
    if (!request) return;

    const requesterSlot = appState.events.find(e => e.id === request.requesterSlotId);
    const targetSlot = appState.events.find(e => e.id === request.targetSlotId);

    if (requesterSlot && targetSlot) {
        requesterSlot.userId = request.targetUserId;
        targetSlot.userId = request.requesterId;
        requesterSlot.status = 'BUSY';
        targetSlot.status = 'BUSY';
        request.status = 'ACCEPTED';
        renderApp('swaps');
        showMessage(null, 'Swap accepted!', 'success');
    }
}

function rejectSwap(requestId) {
    const request = appState.swapRequests.find(r => r.id === requestId);
    if (!request) return;

    const requesterSlot = appState.events.find(e => e.id === request.requesterSlotId);
    const targetSlot = appState.events.find(e => e.id === request.targetSlotId);

    if (requesterSlot && targetSlot) {
        requesterSlot.status = 'SWAPPABLE';
        targetSlot.status = 'SWAPPABLE';
        request.status = 'REJECTED';
        renderApp('swaps');
        showMessage(null, 'Swap rejected', 'success');
    }
}

// ==================== UTILITY FUNCTIONS ====================
function logout() {
    appState.currentUser = null;
    renderApp('login');
}

function showMessage(elementId, message, type) {
    if (!elementId) {
        alert(message);
        return;
    }
    const element = document.getElementById(elementId);
    if (element) {
        element.innerHTML = `<div class="${type}-message">${message}</div>`;
    }
}
    </script>
</body>
</html>
